{% extends "generator/base.html" %}
{% block title %}History — PolicyGen{% endblock %}
{% block content %}
  <h2>Your Generated Policies</h2>

  {% if policies %}
    {% for p in policies %}
      <div class="card">
        <div style="display:flex; justify-content:space-between;">
          <div>
            <strong><a href="{% url 'generator:policy_detail' p.pk %}">{{ p.title }}</a></strong>
            <div class="small">Created: {{ p.created_at|date:"Y-m-d H:i" }} • Model: {{ p.model_used }} • Tokens: {{ p.tokens|default:"-" }}</div>
            <div class="meta">Controls: <span class="controls-list">{% for c in p.mapped_controls.all %}{{ c.control_id }}{% if not forloop.last %}, {% endif %}{% endfor %}</span></div>
          </div>
          <div style="text-align:right">
            <a class="btn" href="{% url 'generator:policy_detail' p.pk %}">View</a>
            <a class="btn alt" href="{% url 'generator:policy_edit' p.pk %}" style="margin-left:8px">Edit</a>
          </div>
        </div>
      </div>
    {% endfor %}

    {% if is_paginated %}
      <div class="small">Page navigation here (use pagination controls in view)</div>
    {% endif %}
  {% else %}
    <p>No generated policies yet. Use Generate or Batch to create policies.</p>
  {% endif %}
{% endblock %}

